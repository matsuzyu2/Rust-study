# Chapter 08: éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° å¯¾è©±ç·¨

> **ã“ã®ç« ã§å­¦ã¶ã“ã¨**: async/awaitã€Futureã€tokioãƒ©ãƒ³ã‚¿ã‚¤ãƒ  â€” Rustã§ã®éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ä»•çµ„ã¿ã¨å®Ÿè·µ

> ğŸ“– **è¨˜å·ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹**: ã“ã®ç« ã§ã¯ `async`, `await`, `move`, `'static` ãªã©å¤šãã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒç™»å ´ã—ã¾ã™ã€‚æ„å‘³ãŒã‚ã‹ã‚‰ãªããªã£ãŸã‚‰ [Chapter 11: è¨˜å·ãƒ»æ§‹æ–‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](11-syntax-reference.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°ï¼šasync/awaitã£ã¦åŒã˜ï¼Ÿ

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã€Œå…ˆè¼©ã€Rustã§ã‚‚éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒã§ãã‚‹ã£ã¦èã„ãŸã‚“ã§ã™ã‘ã©ã€`async/await`ã£ã¦JavaScriptã¨åŒã˜æ„Ÿã˜ã§ä½¿ãˆã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€
>
> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã€Œã†ã‚“ã€åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯ä¼¼ã¦ã‚‹ã‚ˆã€‚ã§ã‚‚ã€Rustã®éåŒæœŸã¯**è£å´ã®ä»•çµ„ã¿ãŒå…¨ç„¶é•ã†**ã®ã€‚ã¾ãšã¯ç°¡å˜ãªä¾‹ã‹ã‚‰è¦‹ã¦ã¿ã‚ˆã†ã‹ã€‚ã€

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã†ã‚“ã€åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯ä¼¼ã¦ã‚‹ã‚ˆã€‚ã§ã‚‚ã€Rustã®éåŒæœŸã¯**è£å´ã®ä»•çµ„ã¿ãŒå…¨ç„¶é•ã†**ã®ã€‚ã¾ãšã¯ç°¡å˜ãªä¾‹ã‹ã‚‰è¦‹ã¦ã¿ã‚ˆã†ã‹ã€‚

```rust
async fn hello() -> String {
    String::from("Hello, async world!")
}

#[tokio::main]
async fn main() {
    let result = hello().await;
    println!("{}", result);
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã‚Œã€`async function`ã˜ã‚ƒãªãã¦`async fn`ãªã‚“ã ã­ã€‚ãã‚Œã«`await`ãŒå¾Œã‚ã«ã¤ã„ã¦ã‚‹ï¼JavaScriptã ã¨`await hello()`ã£ã¦æ›¸ãã®ã«ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€ãã‚ŒãŒRustã®ç‰¹å¾´ï¼å¾Œç½®ã®`.await`ã¯ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã§ä½¿ã„ã‚„ã™ãã™ã‚‹ãŸã‚ãªã®ã€‚

```rust
// Rustã®å¾Œç½®.await â€” èª­ã¿ã‚„ã™ã„
let data = fetch_user()
    .await?
    .parse_json()
    .await?
    .validate()?;

// ã‚‚ã—å‰ç½®ã ã£ãŸã‚‰ â€” ãƒã‚¹ãƒˆãŒæ·±ããªã‚‹
let data = validate(await parse_json(await fetch_user())?)?;
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãªã‚‹ã»ã©ï¼ç¢ºã‹ã«ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã ã¨å¾Œç½®ã®æ–¹ãŒè‡ªç„¶ã‹ã‚‚ã€‚ã‚ã¨`#[tokio::main]`ã£ã¦ä½•ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã‚Œã¯**tokioãƒ©ãƒ³ã‚¿ã‚¤ãƒ **ã‚’èµ·å‹•ã™ã‚‹ãƒã‚¯ãƒ­ã‚ˆã€‚å®Ÿã¯ã­ã€Rustã®`async/await`ã¯**ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒãªã„ã¨å‹•ã‹ãªã„**ã®ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãˆã€JavaScriptã ã¨æ™®é€šã«`async/await`ä½¿ãˆã‚‹ã®ã«ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€Node.jsã‚„ãƒ–ãƒ©ã‚¦ã‚¶ã«ã¯æœ€åˆã‹ã‚‰ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã‚‹ã‹ã‚‰ã­ã€‚ã§ã‚‚Rustã¯ã€Œä½¿ã‚ãªã„äººã«ã‚³ã‚¹ãƒˆã‚’æ‰•ã‚ã›ãªã„ã€ã¨ã„ã†å“²å­¦ã ã‹ã‚‰ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯å¤–éƒ¨ã‚¯ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦æä¾›ã•ã‚Œã¦ã‚‹ã®ã€‚

---

## 2. ãªãœéåŒæœŸå‡¦ç†ãŒå¿…è¦ãªã®ã‹

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãã‚‚ãã‚‚ãªã‚“ã§éåŒæœŸå‡¦ç†ãŒå¿…è¦ãªã®ï¼ŸNode.jsã ã¨å½“ãŸã‚Šå‰ã«ä½¿ã£ã¦ãŸã‘ã©ã€æ”¹ã‚ã¦ç†ç”±ã‚’èã‹ã‚Œã‚‹ã¨...

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã„ã„è³ªå•ï¼å…·ä½“ä¾‹ã§è€ƒãˆã¦ã¿ã‚ˆã†ã€‚APIã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã—ã¦ã€åˆ¥ã®APIã«é€šçŸ¥ã™ã‚‹å‡¦ç†ãŒã‚ã‚‹ã¨ã™ã‚‹ã‚ˆã­ã€‚

```
1. APIã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ï¼ˆ100msï¼‰
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ï¼ˆ50msï¼‰
3. åˆ¥ã®APIã«é€šçŸ¥ï¼ˆ80msï¼‰
```

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: **åŒæœŸå‡¦ç†**ã ã¨ã€ã“ã†ãªã‚‹ã®ã€‚

```
æ™‚é–“ â†’
[APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå¾…ã¡ 100ms][DBå¾…ã¡ 50ms][APIé€šçŸ¥å¾…ã¡ 80ms]
åˆè¨ˆ: 230msã€ã“ã®é–“ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ä½•ã‚‚ã›ãšå¾…æ©Ÿ
```

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã§ã‚‚**éåŒæœŸå‡¦ç†**ãªã‚‰ã€å¾…ã¡æ™‚é–“ä¸­ã«ä»–ã®å‡¦ç†ãŒã§ãã‚‹ã€‚

```
æ™‚é–“ â†’
[APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ]  [DB]  [APIé€šçŸ¥]
    â†“å¾…ã¡æ™‚é–“ä¸­ã«ä»–ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã§ãã‚‹
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã‚ã€I/Oå¾…ã¡ã®æ™‚é–“ã‚’ç„¡é§„ã«ã—ãªã„ã£ã¦ã“ã¨ã­ã€‚Node.jsã ã¨ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚‚å¤§é‡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŒã‘ã‚‹ã®ã¯ãã†ã„ã†ã‚ã‘ã‹ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã®é€šã‚Šï¼ãã‚Œã«ã€Rustã®éåŒæœŸå‡¦ç†ã¯**ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒã™ã”ãã„ã„**ã®ã€‚

| ãƒ¢ãƒ‡ãƒ« | èª¬æ˜ | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | ä¾‹ |
|-------|------|-------------|-----|
| åŒæœŸï¼ˆãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼‰ | å‡¦ç†å®Œäº†ã¾ã§å¾…ã¤ | åŠ¹ç‡çš„ | å¾“æ¥ã®Python |
| ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ | å„æ¥ç¶šã«ã‚¹ãƒ¬ãƒƒãƒ‰ | é«˜ã„ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰æ¯ã«MBå˜ä½ï¼‰ | Javaã€Go |
| éåŒæœŸï¼ˆãƒãƒ³ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼‰ | å¾…ã¡æ™‚é–“ã«ä»–ã®å‡¦ç† | ä½ã„ï¼ˆã‚¿ã‚¹ã‚¯æ¯ã«KBå˜ä½ï¼‰ | Node.jsã€Python asyncioã€Rust |

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã£ã¦1ä¸‡æ¥ç¶šã ã¨ã©ã®ãã‚‰ã„ãƒ¡ãƒ¢ãƒªä½¿ã†ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ¢ãƒ‡ãƒ«ã ã¨æ•°GBã«ãªã£ã¡ã‚ƒã†ã€‚ã§ã‚‚éåŒæœŸãƒ¢ãƒ‡ãƒ«ãªã‚‰æ•°åMBã§æ¸ˆã‚€ã®ã€‚ã“ã‚ŒãŒRustã§é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆãªã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã‚Œã‚‹ç†ç”±ã®ä¸€ã¤ã‚ˆã€‚

---

## 3. Futureã®ç§˜å¯† â€” JavaScriptã¨ã®æœ€å¤§ã®é•ã„

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã˜ã‚ƒã‚åŸºæœ¬çš„ã«Promiseã¨åŒã˜æ„Ÿã˜ã§ä½¿ãˆã°ã„ã„ã‚“ã ã­ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã¡ã‚‡ã£ã¨å¾…ã£ã¦ï¼ã“ã“ã‹ã‚‰ãŒ**Rustã®éåŒæœŸã®æœ€å¤§ã®ç‰¹å¾´**ãªã®ã€‚å®Ÿã¯ã€`async fn`ã¯**Futureã‚’è¿”ã™é–¢æ•°**ãªã‚“ã ã‚ˆã€‚

```rust
use std::future::Future;

// ã“ã®2ã¤ã¯åŒç­‰
async fn hello() -> String {
    String::from("Hello")
}

fn hello_explicit() -> impl Future<Output = String> {
    async {
        String::from("Hello")
    }
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãˆã€`impl Future<Output = String>`ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã†ã‚“ã€‚`async fn hello() -> String`ã£ã¦æ›¸ãã¨ã€å®Ÿéš›ã«ã¯ã€Œ`String`ã‚’è¿”ã™Futureã‚’è¿”ã™é–¢æ•°ã€ã«ãªã‚‹ã®ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: Promiseã¨åŒã˜ã‚ˆã†ãªã‚‚ã®ã‹ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã†ã†ã‚“ã€**ã“ã“ãŒå…¨ç„¶é•ã†**ã®ï¼è¦‹ã¦ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã€‚

```rust
async fn expensive_computation() -> i32 {
    println!("è¨ˆç®—é–‹å§‹!");  // awaitã•ã‚Œã‚‹ã¾ã§å®Ÿè¡Œã•ã‚Œãªã„ï¼
    42
}

#[tokio::main]
async fn main() {
    let future = expensive_computation();  // â† ã“ã“ã§ã¯ä½•ã‚‚å®Ÿè¡Œã•ã‚Œãªã„
    println!("Futureã‚’ä½œæˆ");

    let result = future.await;  // â† ã“ã“ã§åˆã‚ã¦ã€Œè¨ˆç®—é–‹å§‹!ã€ãŒå‡ºåŠ›ã•ã‚Œã‚‹
    println!("çµæœ: {}", result);
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãˆã€ä½•ã“ã‚Œã€‚å‡ºåŠ›é †ã¯...

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã“ã†ãªã‚‹ã‚ˆã€‚

```
Futureã‚’ä½œæˆ
è¨ˆç®—é–‹å§‹!
çµæœ: 42
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ï¼ï¼Ÿ `expensive_computation()`ã‚’å‘¼ã‚“ã ã®ã«å®Ÿè¡Œã•ã‚Œã¦ãªã„ï¼

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€ã“ã‚ŒãŒ**Futureã®é…å»¶è©•ä¾¡ï¼ˆLazyï¼‰**ï¼JavaScriptã¨ã®æœ€å¤§ã®é•ã„ãªã®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JavaScript/Python vs Rust ã®éåŒæœŸ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  JavaScript:                                                    â”‚
â”‚    const promise = fetchData();  // å³åº§ã«å®Ÿè¡Œé–‹å§‹               â”‚
â”‚    await promise;                // å®Œäº†ã‚’å¾…ã¤ã ã‘               â”‚
â”‚                                                                 â”‚
â”‚  Python:                                                        â”‚
â”‚    coro = fetch_data()           # ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ     â”‚
â”‚    await coro                    # å®Ÿè¡Œé–‹å§‹ï¼‹å®Œäº†å¾…ã¡            â”‚
â”‚                                                                 â”‚
â”‚  Rust:                                                          â”‚
â”‚    let future = fetch_data();    // Futureã‚’ä½œæˆï¼ˆä½•ã‚‚å®Ÿè¡Œã—ãªã„ï¼‰â”‚
â”‚    future.await;                 // å®Ÿè¡Œé–‹å§‹ï¼‹å®Œäº†å¾…ã¡            â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Rustã®è¨­è¨ˆç†ç”±:                                                 â”‚
â”‚  1. ã‚¼ãƒ­ã‚³ã‚¹ãƒˆæŠ½è±¡åŒ– â€” ä½¿ã‚ãªã„ã‚‚ã®ã«ã‚³ã‚¹ãƒˆã‚’æ‰•ã‚ãªã„             â”‚
â”‚  2. æ˜ç¤ºçš„ãªåˆ¶å¾¡ â€” ã„ã¤å®Ÿè¡Œã™ã‚‹ã‹ã‚’å®Œå…¨ã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«             â”‚
â”‚  3. ã‚­ãƒ£ãƒ³ã‚»ãƒ« â€” awaitã—ãªã‘ã‚Œã°ãƒªã‚½ãƒ¼ã‚¹ã‚’æ¶ˆè²»ã—ãªã„              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã¸ãˆ...JavaScriptã ã¨é–¢æ•°å‘¼ã‚“ã ã‚‰å³åº§ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé£›ã¶ã‘ã©ã€Rustã ã¨awaitã™ã‚‹ã¾ã§ä½•ã‚‚ã—ãªã„ã‚“ã ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ï¼ã“ã‚ŒãŒã€Œã‚¼ãƒ­ã‚³ã‚¹ãƒˆæŠ½è±¡åŒ–ã€ã®ä¸€éƒ¨ã€‚ä½¿ã‚ãªã„Futureã¯ä½•ã‚‚ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‰ãªã„ã®ã€‚ãã‚Œã«ã€Futureã‚’awaitã—ãªã‘ã‚Œã°ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¨åŒã˜åŠ¹æœã«ãªã‚‹ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãªã‚‹ã»ã©ã€æ˜ç¤ºçš„ã§ã„ã„ã­ã€‚ã§ã‚‚ã€ãªã‚“ã§ãã†ã„ã†è¨­è¨ˆã«ãªã£ã¦ã‚‹ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: Futureã®å†…éƒ¨æ§‹é€ ã‚’è¦‹ã‚‹ã¨ã‚ã‹ã‚‹ã‚ˆã€‚

---

## 4. Futureãƒˆãƒ¬ã‚¤ãƒˆã®å†…å´

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: Futureãƒˆãƒ¬ã‚¤ãƒˆã¯ã“ã‚“ãªæ„Ÿã˜ã§å®šç¾©ã•ã‚Œã¦ã‚‹ã®ã€‚

```rust
// æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã®å®šç¾©ï¼ˆç°¡ç•¥åŒ–ï¼‰
trait Future {
    type Output;

    fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output>;
}

enum Poll<T> {
    Ready(T),    // å®Œäº†ã€çµæœã¯T
    Pending,     // ã¾ã å®Œäº†ã—ã¦ã„ãªã„
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `poll`ãƒ¡ã‚½ãƒƒãƒ‰...ï¼ŸJavaScriptã®Promiseã«ã¯è¦‹ãŸã“ã¨ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ã©ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€ã“ã“ãŒRustã®éåŒæœŸã®æ ¸å¿ƒï¼Rustã®éåŒæœŸã¯**pollé§†å‹•**ãªã®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Future ã®å®Ÿè¡Œãƒ¢ãƒ‡ãƒ«                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ï¼ˆtokioï¼‰ãŒFutureã®poll()ã‚’å‘¼ã¶                    â”‚
â”‚                                                                 â”‚
â”‚  2. Futureã¯å‡¦ç†ã‚’é€²ã‚ã‚‹                                         â”‚
â”‚     - I/Oå¾…ã¡ã«ãªã£ãŸã‚‰ â†’ Poll::Pending ã‚’è¿”ã™                   â”‚
â”‚     - å®Œäº†ã—ãŸã‚‰ â†’ Poll::Ready(çµæœ) ã‚’è¿”ã™                      â”‚
â”‚                                                                 â”‚
â”‚  3. Pendingã®å ´åˆã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯ä»–ã®Futureã‚’å®Ÿè¡Œ                   â”‚
â”‚                                                                 â”‚
â”‚  4. I/OãŒå®Œäº†ã™ã‚‹ã¨ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«é€šçŸ¥ï¼ˆWakerï¼‰                    â”‚
â”‚                                                                 â”‚
â”‚  5. ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯å†åº¦poll()ã‚’å‘¼ã¶                                 â”‚
â”‚                                                                 â”‚
â”‚  ã“ã‚Œã‚’ã€Œå”èª¿çš„ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ã€ã¨å‘¼ã¶                               â”‚
â”‚  ï¼ˆFutureãŒè‡ªç™ºçš„ã«åˆ¶å¾¡ã‚’è¿”ã™ï¼‰                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã¸ãˆã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒä½•åº¦ã‚‚pollã‚’å‘¼ã‚“ã§ã€Œã¾ã ï¼Ÿã€ã€Œã¾ã ï¼Ÿã€ã£ã¦èã„ã¦ã‚‹æ„Ÿã˜ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ï¼ã§ã‚‚è³¢ã„ã®ã¯ã€I/OãŒå®Œäº†ã—ãŸã‚‰**Waker**ã£ã¦ã„ã†ä»•çµ„ã¿ã§ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«é€šçŸ¥ã™ã‚‹ã‹ã‚‰ã€ç„¡é§„ãªãƒãƒ¼ãƒªãƒ³ã‚°ã¯ã—ãªã„ã®ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãªã‚‹ã»ã©ã€‚JavaScriptã®Promiseã¯ãã†ã„ã†ä»•çµ„ã¿ãŒè¦‹ãˆãªã„ã‘ã©ã€Rustã ã¨æ˜ç¤ºçš„ãªã‚“ã ã­ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã†ã‚“ã€‚ã ã‹ã‚‰ã“ããƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚‚ã—ã‚„ã™ã„ã—ã€ãƒ‡ãƒãƒƒã‚°ã‚‚ã—ã‚„ã™ã„ã€‚ã€Œãªãœã“ã®FutureãŒé€²ã¾ãªã„ã®ã‹ã€ãŒã‚ã‹ã‚‹ã‹ã‚‰ã­ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã§ã‚‚`Pin<&mut Self>`ã¨ã‹`Context<'_>`ã¨ã‹ã€é›£ã—ãã†ãªã®ãŒå‡ºã¦ããŸ...

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã‚Œã¯å¾Œã§èª¬æ˜ã™ã‚‹ã­ã€‚ä»Šã¯ã€Œpollã§é€²æ—ã‚’ç¢ºèªã™ã‚‹ã€ã£ã¦ã„ã†ãƒ¢ãƒ‡ãƒ«ã ã‘è¦šãˆã¦ãŠã‘ã°å¤§ä¸ˆå¤«ã€‚æ™®é€šã«async/awaitã‚’ä½¿ã†åˆ†ã«ã¯æ„è­˜ã—ãªãã¦ã„ã„ã‹ã‚‰ã€‚

---

## 5. tokioãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ä¸–ç•Œ

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã•ã£ãã‹ã‚‰ã€Œtokioãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€ã£ã¦è¨€ã£ã¦ã‚‹ã‘ã©ã€ãã‚Œã£ã¦ä½•ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: tokioã¯Rustã§æœ€ã‚‚äººæ°—ã®ã‚ã‚‹éåŒæœŸãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚ˆã€‚JavaScriptãªã‚‰Node.jsã‚„ãƒ–ãƒ©ã‚¦ã‚¶ãŒéåŒæœŸã‚’å‹•ã‹ã™ç’°å¢ƒã‚’æä¾›ã—ã¦ã‚‹ã§ã—ã‚‡ï¼ŸRustã§ã¯ãã‚Œã‚’tokioãŒæ‹…å½“ã™ã‚‹ã®ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãªã‚“ã§æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å…¥ã£ã¦ãªã„ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã‚ŒãŒRustã®å“²å­¦ãªã®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Rustã®è¨­è¨ˆå“²å­¦                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€Œã‚¼ãƒ­ã‚³ã‚¹ãƒˆæŠ½è±¡åŒ–ã€ã¨ã€Œé¸æŠã®è‡ªç”±ã€                             â”‚
â”‚                                                                 â”‚
â”‚  - éåŒæœŸã‚’ä½¿ã‚ãªã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ã‚³ã‚¹ãƒˆã‚’å¼·åˆ¶ã—ãªã„      â”‚
â”‚  - ç”¨é€”ã«å¿œã˜ã¦æœ€é©ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’é¸ã¹ã‚‹                          â”‚
â”‚                                                                 â”‚
â”‚  ä¸»ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ :                                                 â”‚
â”‚  - tokio: æœ€ã‚‚äººæ°—ã€‚æ±ç”¨çš„ã€‚                                     â”‚
â”‚  - async-std: æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«è¿‘ã„APIã€‚                          â”‚
â”‚  - smol: è»½é‡ã€‚çµ„ã¿è¾¼ã¿å‘ã‘ã€‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãµãƒ¼ã‚“ã€é¸æŠè‚¢ãŒã‚ã‚‹ã‚“ã ã€‚ã§ã‚‚tokioãŒä¸€ç•ªäººæ°—ãªã‚“ã ã‚ˆã­ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€‚Webé–‹ç™ºã§ã¯ã»ã¼tokioä¸€æŠã¨è¨€ã£ã¦ã„ã„ãã‚‰ã„ã€‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯ç°¡å˜ã‚ˆã€‚

```toml
# Cargo.toml
[dependencies]
tokio = { version = "1", features = ["full"] }
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `features = ["full"]`ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: tokioã¯æ©Ÿèƒ½ãŒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã•ã‚Œã¦ã‚‹ã®ã€‚`"full"`ã¯å…¨éƒ¨å…¥ã‚Šã§ã€é–‹ç™ºä¸­ã¯ä¾¿åˆ©ã€‚æœ¬ç•ªã§ã¯ä½¿ã†æ©Ÿèƒ½ã ã‘é¸ã¶ã¨è»½ããªã‚‹ã‚ˆã€‚

```toml
# æœ¬ç•ªç’°å¢ƒã®ä¾‹
tokio = { version = "1", features = ["rt-multi-thread", "net", "time"] }
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãªã‚‹ã»ã©ã€‚ã˜ã‚ƒã‚ä½¿ã£ã¦ã¿ã‚ˆã†ã€‚

```rust
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() {
    println!("é–‹å§‹");
    sleep(Duration::from_secs(1)).await;
    println!("1ç§’å¾Œ");
}
```

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã„ã„ã­ï¼ã¡ãªã¿ã«`#[tokio::main]`ã¯å®Ÿã¯ãƒã‚¯ãƒ­ã§ã€ã“ã†å±•é–‹ã•ã‚Œã‚‹ã®ã€‚

```rust
// #[tokio::main]
// async fn main() { ... }

// â†“ å±•é–‹å¾Œ

fn main() {
    tokio::runtime::Builder::new_multi_thread()
        .enable_all()
        .build()
        .unwrap()
        .block_on(async {
            // ã“ã“ã«async fn main()ã®ä¸­èº«
        })
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã¸ãˆã€`block_on`ã§asyncã®mainã‚’å®Ÿè¡Œã—ã¦ã‚‹ã‚“ã ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€‚ã“ã‚Œã‚’çŸ¥ã£ã¦ã‚‹ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ã‚ˆã€‚

```rust
// ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ï¼ˆè»½é‡ï¼‰
#[tokio::main(flavor = "current_thread")]
async fn main() { ... }

// ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰æ•°ã‚’æŒ‡å®š
#[tokio::main(worker_threads = 4)]
async fn main() { ... }
```

---

## 6. ä¸¦è¡Œå®Ÿè¡Œã®é­”æ³• â€” join!ã¨select!

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã­ãˆã€JavaScriptã®`Promise.all`ã¿ãŸã„ã«è¤‡æ•°ã®éåŒæœŸå‡¦ç†ã‚’ä¸¦è¡Œå®Ÿè¡Œã—ãŸã„ã‚“ã ã‘ã©ã€ã©ã†ã™ã‚Œã°ã„ã„ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: `tokio::join!`ã‚’ä½¿ãˆã°ã„ã„ã‚ˆï¼

```rust
use tokio::time::{sleep, Duration};

async fn task1() -> String {
    println!("Task1: é–‹å§‹");
    sleep(Duration::from_secs(1)).await;
    println!("Task1: å®Œäº†");
    String::from("Task 1 ã®çµæœ")
}

async fn task2() -> String {
    println!("Task2: é–‹å§‹");
    sleep(Duration::from_secs(2)).await;
    println!("Task2: å®Œäº†");
    String::from("Task 2 ã®çµæœ")
}

#[tokio::main]
async fn main() {
    // ä¸¦è¡Œå®Ÿè¡Œï¼ˆåˆè¨ˆ2ç§’ã§å®Œäº†ï¼‰
    let (result1, result2) = tokio::join!(task1(), task2());

    println!("{}", result1);
    println!("{}", result2);
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: å‡ºåŠ›ã¯...ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã“ã†ãªã‚‹ã‚ˆã€‚

```
Task1: é–‹å§‹
Task2: é–‹å§‹
Task1: å®Œäº†    â† 1ç§’å¾Œ
Task2: å®Œäº†    â† 2ç§’å¾Œï¼ˆtask1ã¨ä¸¦è¡Œã—ã¦é€²ã‚“ã§ã„ãŸï¼‰
Task 1 ã®çµæœ
Task 2 ã®çµæœ
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãŠãŠã€ã¡ã‚ƒã‚“ã¨ä¸¦è¡Œå®Ÿè¡Œã•ã‚Œã¦ã‚‹ï¼åˆè¨ˆ2ç§’ã§çµ‚ã‚ã£ã¦ã‚‹ã‚‚ã‚“ã­ã€‚ã“ã‚Œä¸¦åˆ—å®Ÿè¡Œï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã„ã„è³ªå•ï¼å®Ÿã¯**ä¸¦è¡Œï¼ˆconcurrentï¼‰**ã§ã‚ã£ã¦**ä¸¦åˆ—ï¼ˆparallelï¼‰**ã§ã¯ãªã„ã®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸¦è¡Œ vs ä¸¦åˆ—                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ä¸¦è¡Œï¼ˆConcurrentï¼‰:                                             â”‚
â”‚    1ã¤ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã‚’äº¤äº’ã«å®Ÿè¡Œ                        â”‚
â”‚    ã‚¿ã‚¹ã‚¯A â†’ I/Oå¾…ã¡ â†’ ã‚¿ã‚¹ã‚¯B â†’ I/Oå¾…ã¡ â†’ ã‚¿ã‚¹ã‚¯A...            â”‚
â”‚                                                                 â”‚
â”‚  ä¸¦åˆ—ï¼ˆParallelï¼‰:                                               â”‚
â”‚    è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰/CPUã§åŒæ™‚ã«å®Ÿè¡Œ                                 â”‚
â”‚    ã‚¹ãƒ¬ãƒƒãƒ‰1: ã‚¿ã‚¹ã‚¯A                                            â”‚
â”‚    ã‚¹ãƒ¬ãƒƒãƒ‰2: ã‚¿ã‚¹ã‚¯B                                            â”‚
â”‚                                                                 â”‚
â”‚  tokio::join! â†’ ä¸¦è¡Œ                                            â”‚
â”‚  tokio::spawn â†’ ä¸¦åˆ—ã‚‚å¯èƒ½ï¼ˆãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®å ´åˆï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã‚ã€Node.jsã¨åŒã˜ã‹ã€‚ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ä¸¦è¡Œå‡¦ç†ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®tokioãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã ã‹ã‚‰ã€çŠ¶æ³ã«ã‚ˆã£ã¦ã¯ä¸¦åˆ—ã«ã‚‚ãªã‚‹ã‘ã©ã­ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã˜ã‚ƒã‚`Promise.race`ã¿ãŸã„ã«ã€Œæœ€åˆã«çµ‚ã‚ã£ãŸæ–¹ã€ã‚’å¾…ã¤ã®ã¯ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: `tokio::select!`ã‚’ä½¿ã†ã‚ˆã€‚

```rust
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() {
    tokio::select! {
        _ = sleep(Duration::from_secs(1)) => {
            println!("1ç§’çµŒé");
        }
        _ = sleep(Duration::from_secs(2)) => {
            println!("2ç§’çµŒé");  // ã“ã‚Œã¯å®Ÿè¡Œã•ã‚Œãªã„
        }
    }
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã“ã‚Œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ã«ä½¿ãˆãã†ï¼

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã®é€šã‚Šï¼tokioã«ã¯å°‚ç”¨ã®é–¢æ•°ã‚‚ã‚ã‚‹ã‚ˆã€‚

```rust
use tokio::time::{sleep, Duration, timeout};

async fn slow_operation() -> String {
    sleep(Duration::from_secs(10)).await;
    String::from("å®Œäº†")
}

#[tokio::main]
async fn main() {
    // 5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
    match timeout(Duration::from_secs(5), slow_operation()).await {
        Ok(result) => println!("æˆåŠŸ: {}", result),
        Err(_) => println!("ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼"),
    }
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã“ã‚Œã‚ã£ã¡ã‚ƒä¾¿åˆ©ã˜ã‚ƒã‚“ï¼

---

## 7. spawn â€” ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã®è½ã¨ã—ç©´

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã¨ã“ã‚ã§ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ãŸã„å ´åˆã¯ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: `tokio::spawn`ã‚’ä½¿ã†ã‚ˆã€‚

```rust
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() {
    // ã‚¿ã‚¹ã‚¯ã‚’spawnï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œé–‹å§‹ï¼‰
    let handle = tokio::spawn(async {
        sleep(Duration::from_secs(1)).await;
        42
    });

    println!("ã‚¿ã‚¹ã‚¯ã‚’ç”Ÿæˆã—ã¾ã—ãŸ");

    // ä»–ã®å‡¦ç†ã‚’ã—ã¦ã„ã‚‹é–“ã‚‚ã‚¿ã‚¹ã‚¯ã¯é€²è¡Œä¸­

    // çµæœã‚’å¾…ã¤
    let result = handle.await.unwrap();
    println!("çµæœ: {}", result);
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `join!`ã¨ä½•ãŒé•ã†ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: `join!`ã¯ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯å†…ã§ä¸¦è¡Œå®Ÿè¡Œã™ã‚‹ã‘ã©ã€`spawn`ã¯**åˆ¥ã‚¿ã‚¹ã‚¯**ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã®ã€‚ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãªã‚‰åˆ¥ã®CPUã‚³ã‚¢ã§å‹•ãå¯èƒ½æ€§ã‚‚ã‚ã‚‹ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã˜ã‚ƒã‚spawnã®æ–¹ãŒã„ã„ã˜ã‚ƒã‚“ï¼

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã¡ã‚‡ã£ã¨å¾…ã£ã¦ã€‚spawnã«ã¯**åˆ¶ç´„**ãŒã‚ã‚‹ã®ã€‚ã“ã‚ŒãŒåˆå¿ƒè€…ã®è½ã¨ã—ç©´ã€‚

```rust
// âŒ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼
fn bad_spawn() {
    let data = String::from("hello");

    tokio::spawn(async {
        println!("{}", data);  // dataã‚’å€Ÿç”¨
    });  // ã‚¨ãƒ©ãƒ¼: `data`ã¯ã“ã®ã‚¹ã‚³ãƒ¼ãƒ—ã§ç ´æ£„ã•ã‚Œã‚‹ãŒã€ã‚¿ã‚¹ã‚¯ã¯ã¾ã ä½¿ãŠã†ã¨ã—ã¦ã„ã‚‹
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã€å€Ÿç”¨ã®ã‚¨ãƒ©ãƒ¼ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€‚spawnã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‹•ãã‹ã‚‰ã€ã„ã¤ã¾ã§ç”Ÿãã¦ã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã€‚ã ã‹ã‚‰`data`ãŒå…ˆã«ç ´æ£„ã•ã‚Œã¡ã‚ƒã†ã‹ã‚‚ã—ã‚Œãªã„ã®ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã©ã†ã™ã‚Œã°ã„ã„ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: `move`ã§æ‰€æœ‰æ¨©ã‚’ç§»å‹•ã•ã›ã‚‹ã®ã€‚

```rust
// âœ… move ã§æ‰€æœ‰æ¨©ã‚’ç§»å‹•
fn good_spawn() {
    let data = String::from("hello");

    tokio::spawn(async move {  // move ã‚’è¿½åŠ 
        println!("{}", data);  // dataã®æ‰€æœ‰æ¨©ã‚’æŒã£ã¦ã„ã‚‹
    });
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã‚ã€`async move`ã‹ã€‚ã“ã‚ŒChapter 5ã®ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã§ç¿’ã£ãŸã‚„ã¤ã ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã®é€šã‚Šï¼ã§ã‚‚åˆ¶ç´„ã¯ãã‚Œã ã‘ã˜ã‚ƒãªã„ã®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  spawn ã¨ 'static å¢ƒç•Œ                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  tokio::spawn(future) ã® future ã«ã¯ä»¥ä¸‹ãŒè¦æ±‚ã•ã‚Œã‚‹ï¼š           â”‚
â”‚                                                                 â”‚
â”‚  1. Send â€” åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã«é€ã‚Œã‚‹                                    â”‚
â”‚     ï¼ˆãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã¯åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§ï¼‰   â”‚
â”‚                                                                 â”‚
â”‚  2. 'static â€” å‚ç…§ãŒãªã„ã€ã¾ãŸã¯'staticãªå‚ç…§ã®ã¿                 â”‚
â”‚     ï¼ˆã‚¿ã‚¹ã‚¯ãŒã„ã¤ã¾ã§ç”Ÿå­˜ã™ã‚‹ã‹ä¸æ˜ãªãŸã‚ï¼‰                      â”‚
â”‚                                                                 â”‚
â”‚  move ã‚’ä½¿ã†ã¨:                                                  â”‚
â”‚  - å¤‰æ•°ã®æ‰€æœ‰æ¨©ãŒã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã«ç§»å‹•                                 â”‚
â”‚  - ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã¯å¤–éƒ¨ã¸ã®å‚ç…§ã‚’æŒãŸãªããªã‚‹                         â”‚
â”‚  - 'static ã‚’æº€ãŸã›ã‚‹                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `Send`ã¨`'static`...é›£ã—ãã†ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ä¾‹ã‚’è¦‹ã›ã‚‹ã­ã€‚ã“ã‚Œã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã‚ˆã€‚

```rust
use std::rc::Rc;

// âŒ Rc ã¯ Send ã‚’å®Ÿè£…ã—ã¦ã„ãªã„
let data = Rc::new(42);
tokio::spawn(async move {
    println!("{}", data);  // ã‚¨ãƒ©ãƒ¼ï¼
});
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `Rc`ãŒãƒ€ãƒ¡ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: `Rc`ã¯ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰å°‚ç”¨ã®å‚ç…§ã‚«ã‚¦ãƒ³ã‚¿ã ã‹ã‚‰ã€`Send`ã‚’å®Ÿè£…ã—ã¦ãªã„ã®ã€‚ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§ä½¿ãˆã‚‹`Arc`ãªã‚‰å¤§ä¸ˆå¤«ã€‚

```rust
// âœ… Arc ã¯ Send ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹
use std::sync::Arc;
let data = Arc::new(42);
tokio::spawn(async move {
    println!("{}", data);  // OK
});
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãªã‚‹ã»ã©...spawnã¯ä¾¿åˆ©ã ã‘ã©ã€åˆ¶ç´„ãŒã„ã‚ã„ã‚ã‚ã‚‹ã‚“ã ã­ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€‚ã ã‹ã‚‰**åŸºæœ¬çš„ã«ã¯join!ã‚’ä½¿ã£ã¦ã€æœ¬å½“ã«å¿…è¦ãªã¨ãã ã‘spawnã‚’ä½¿ã†**ã®ãŒãŠã™ã™ã‚ã‚ˆã€‚

---

## 8. async moveã®æ­£ä½“

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `async move`ã£ã¦ã‚‚ã†ã¡ã‚‡ã£ã¨è©³ã—ãæ•™ãˆã¦ã€‚ã„ã¤ä½¿ãˆã°ã„ã„ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã„ã„è³ªå•ï¼æ¯”è¼ƒã—ã¦è¦‹ã›ã‚‹ã­ã€‚

```rust
async fn process_data(data: String) {
    println!("å‡¦ç†: {}", data);
}

#[tokio::main]
async fn main() {
    let data = String::from("important data");

    // move ãªã— â€” data ã‚’å€Ÿç”¨
    let task1 = async {
        println!("{}", data);  // å€Ÿç”¨
    };

    // move ã‚ã‚Š â€” data ã®æ‰€æœ‰æ¨©ã‚’å¥ªã†
    let task2 = async move {
        println!("{}", data);  // æ‰€æœ‰
    };

    // task2 ã®å¾Œã€data ã¯ä½¿ãˆãªã„
    // println!("{}", data);  // âŒ ã‚¨ãƒ©ãƒ¼ï¼æ‰€æœ‰æ¨©ã¯task2ã«ç§»å‹•ã—ãŸ
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã‚ã€æ™®é€šã®ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã®`move`ã¨åŒã˜ã‹ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€‚ã§ã‚‚`async move`ãŒ**ç‰¹ã«å¿…è¦ã«ãªã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³**ãŒã‚ã‚‹ã®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  async move ãŒå¿…è¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. tokio::spawn ã«æ¸¡ã™                                         â”‚
â”‚     tokio::spawn(async move { ... });                           â”‚
â”‚                                                                 â”‚
â”‚  2. Futureã‚’è¿”ã™é–¢æ•°                                            â”‚
â”‚     fn foo() -> impl Future { async move { ... } }             â”‚
â”‚                                                                 â”‚
â”‚  3. FutureãŒå…ƒã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚ˆã‚Šé•·ãç”Ÿå­˜                             â”‚
â”‚     let future = async move { ... };                            â”‚
â”‚     // å…ƒã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŠœã‘ãŸå¾Œã‚‚futureã‚’ä½¿ã„ãŸã„                   â”‚
â”‚                                                                 â”‚
â”‚  4. ãƒ«ãƒ¼ãƒ—å†…ã§spawn                                             â”‚
â”‚     for item in items {                                         â”‚
â”‚         tokio::spawn(async move { use(item) });                 â”‚
â”‚     }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãƒ«ãƒ¼ãƒ—å†…ã§spawnã™ã‚‹ä¾‹è¦‹ã›ã¦ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã“ã†ã„ã†æ„Ÿã˜ã€‚

```rust
#[tokio::main]
async fn main() {
    let items = vec![1, 2, 3, 4, 5];

    let mut handles = vec![];
    for item in items {
        let handle = tokio::spawn(async move {
            // item ã‚’æ‰€æœ‰ã—ã¦ã„ã‚‹ã®ã§ã€ã‚¿ã‚¹ã‚¯ãŒçµ‚ã‚ã‚‹ã¾ã§æœ‰åŠ¹
            println!("å‡¦ç†ä¸­: {}", item);
            item * 2
        });
        handles.push(handle);
    }

    // å…¨ã‚¿ã‚¹ã‚¯ã®å®Œäº†ã‚’å¾…ã¤
    for handle in handles {
        let result = handle.await.unwrap();
        println!("çµæœ: {}", result);
    }
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `async move`ãŒãªã„ã¨ã©ã†ãªã‚‹ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: `item`ã®å€Ÿç”¨ãŒå•é¡Œã«ãªã‚‹ã‚ˆã€‚ãƒ«ãƒ¼ãƒ—ãŒæ¬¡ã«é€²ã‚“ã ã‚‰`item`ã®å€¤ãŒå¤‰ã‚ã£ã¡ã‚ƒã†ã‹ã‚‰ã€ã‚¿ã‚¹ã‚¯ãŒå‚ç…§ã™ã‚‹å€¤ãŒä¸å®šã«ãªã‚‹ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãªã‚‹ã»ã©ã€æ‰€æœ‰æ¨©ã‚’æ¸¡ã™ã“ã¨ã§å„ã‚¿ã‚¹ã‚¯ãŒç‹¬ç«‹ã™ã‚‹ã‚“ã ã€‚

---

## 9. éåŒæœŸã¨ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã®æˆ¦ã„

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã¨asyncã£ã¦ç›¸æ€§æ‚ªãã†...

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ãªã®ï¼ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã›ã‚‹ã­ã€‚

```rust
// âŒ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼
async fn bad_example(data: &String) {
    tokio::spawn(async {
        println!("{}", data);  // dataã¯å€Ÿç”¨ã ãŒã€spawnã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã®ç”Ÿå­˜æœŸé–“ã¯ä¸æ˜
    });
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã“ã‚Œãªã‚“ã§ãƒ€ãƒ¡ãªã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: `data`ã¯å‚ç…§ï¼ˆå€Ÿç”¨ï¼‰ã§ã—ã‚‡ï¼Ÿã§ã‚‚spawnã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ãŒã„ã¤ã¾ã§ç”Ÿãã¦ã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã€‚ã ã‹ã‚‰`data`ãŒå…ˆã«ç ´æ£„ã•ã‚Œã¡ã‚ƒã†ã‹ã‚‚ã—ã‚Œãªã„ã®ã€‚

```
error[E0597]: `data` does not live long enough
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã˜ã‚ƒã‚ã©ã†ã™ã‚Œã°ã„ã„ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: 3ã¤ã®è§£æ±ºç­–ãŒã‚ã‚‹ã‚ˆã€‚

**è§£æ±ºç­–1: ã‚¯ãƒ­ãƒ¼ãƒ³**

```rust
async fn good_example(data: &String) {
    let owned_data = data.clone();  // ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦æ‰€æœ‰
    tokio::spawn(async move {
        println!("{}", owned_data);
    });
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚¯ãƒ­ãƒ¼ãƒ³ã‹...ã‚³ã‚¹ãƒˆã‹ã‹ã‚Šãã†ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã ã­ã€‚å¤§ããªãƒ‡ãƒ¼ã‚¿ã ã¨æ°—ã«ãªã‚‹ã‹ã‚‚ã€‚ãã†ã„ã†ã¨ãã¯æ¬¡ã®æ–¹æ³•ã€‚

**è§£æ±ºç­–2: Arcã§å…±æœ‰**

```rust
use std::sync::Arc;

async fn good_example(data: Arc<String>) {
    let data_clone = Arc::clone(&data);
    tokio::spawn(async move {
        println!("{}", data_clone);
    });
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `Arc::clone`ã£ã¦ã‚³ã‚¹ãƒˆä½ã„ã‚“ã ã£ã‘ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã†ã‚“ã€å‚ç…§ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ã ã‘ã ã‹ã‚‰ã€å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã¯ã‚³ãƒ”ãƒ¼ã•ã‚Œãªã„ã®ã€‚è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã§åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã—ãŸã„ã¨ãã«ä¾¿åˆ©ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ä»–ã®è§£æ±ºç­–ã¯ï¼Ÿ

**è§£æ±ºç­–3: spawnã›ãšã«join!**

```rust
async fn good_example(data: &String) {
    // spawnã§ã¯ãªãjoin!ãªã‚‰å€Ÿç”¨ã§OK
    tokio::join!(
        async { println!("1: {}", data) },
        async { println!("2: {}", data) }
    );
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã‚ã€`join!`ã¯åŒã˜ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§å‹•ãã‹ã‚‰å€Ÿç”¨ã§ã‚‚ã„ã„ã‚“ã ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã®é€šã‚Šï¼ã ã‹ã‚‰ã€ã§ãã‚‹ã ã‘`join!`ã‚’ä½¿ã£ã¦ã€æœ¬å½“ã«å¿…è¦ãªã¨ãã ã‘`spawn`ã‚’ä½¿ã†ã®ãŒãŠã™ã™ã‚ãªã®ã€‚

---

## 10. å®Ÿè·µ: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã§asyncã‚’ä½¿ã£ã¦ã¿ãŸã„ãªã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã˜ã‚ƒã‚HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚„ã£ã¦ã¿ã‚ˆã†ã€‚`reqwest`ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã†ã‚ˆã€‚

```toml
# Cargo.toml
[dependencies]
tokio = { version = "1", features = ["full"] }
reqwest = { version = "0.11", features = ["json"] }
serde = { version = "1.0", features = ["derive"] }
```

```rust
use serde::Deserialize;

#[derive(Debug, Deserialize)]
struct User {
    id: i32,
    name: String,
}

#[tokio::main]
async fn main() -> Result<(), reqwest::Error> {
    let user: User = reqwest::get("https://api.example.com/users/1")
        .await?          // ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†ã‚’å¾…ã¤
        .json()          // JSONã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹ï¼ˆã“ã‚Œã‚‚éåŒæœŸï¼‰
        .await?;

    println!("{:?}", user);
    Ok(())
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã‚Œã€`?`ãŒ2å›ã‚ã‚‹ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€ã„ã„è³ªå•ï¼

1. æœ€åˆã®`?` â€” HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¨ãƒ©ãƒ¼ã‚’ä¼æ’­
2. 2ç•ªç›®ã®`?` â€” JSONãƒ‘ãƒ¼ã‚¹ã®ã‚¨ãƒ©ãƒ¼ã‚’ä¼æ’­

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: JavaScriptã ã¨ã“ã‚“ãªæ„Ÿã˜ã ã‚ˆã­ã€‚

```javascript
const response = await fetch("https://api.example.com/users/1");
const user = await response.json();
```

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ãã†ã€‚Rustã®æ–¹ãŒæ˜ç¤ºçš„ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦ã‚‹ã­ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¯ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: tokioã«ã¯éåŒæœŸãƒ•ã‚¡ã‚¤ãƒ«I/Oã‚‚ã‚ã‚‹ã‚ˆã€‚

```rust
use tokio::fs;

#[tokio::main]
async fn main() -> std::io::Result<()> {
    // ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿
    fs::write("hello.txt", "Hello, Tokio!").await?;

    // ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
    let content = fs::read_to_string("hello.txt").await?;
    println!("{}", content);

    Ok(())
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã£ã¡ã‚ƒã‚·ãƒ³ãƒ—ãƒ«ï¼

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: æ³¨æ„ç‚¹ã¨ã—ã¦ã€å°ã•ã„ãƒ•ã‚¡ã‚¤ãƒ«ãªã‚‰åŒæœŸI/Oã®æ–¹ãŒé€Ÿã„ã“ã¨ã‚‚ã‚ã‚‹ã®ã€‚éåŒæœŸI/Oã¯**å¤§é‡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¦è¡Œå‡¦ç†ã™ã‚‹**ã¨ãã«çœŸä¾¡ã‚’ç™ºæ®ã™ã‚‹ã‚ˆã€‚

---

## 11. ãƒãƒ£ãƒãƒ« â€” ã‚¿ã‚¹ã‚¯é–“é€šä¿¡ã®é­”æ³•

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã§ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šã—ãŸã„ã‚“ã ã‘ã©ã€ã©ã†ã™ã‚Œã°ã„ã„ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: **ãƒãƒ£ãƒãƒ«**ã‚’ä½¿ã†ã¨ã„ã„ã‚ˆï¼

```rust
use tokio::sync::mpsc;

#[tokio::main]
async fn main() {
    // ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚º32ã®ãƒãƒ£ãƒãƒ«ã‚’ä½œæˆ
    let (tx, mut rx) = mpsc::channel(32);

    // é€ä¿¡å´ã‚¿ã‚¹ã‚¯
    let tx_clone = tx.clone();  // è¤‡æ•°ã®é€ä¿¡è€…ã‚’ä½œã‚Œã‚‹
    tokio::spawn(async move {
        for i in 0..5 {
            tx_clone.send(i).await.unwrap();
        }
    });

    // åˆ¥ã®é€ä¿¡è€…
    tokio::spawn(async move {
        for i in 100..105 {
            tx.send(i).await.unwrap();
        }
    });

    // å—ä¿¡å´ï¼ˆå…¨é€ä¿¡è€…ãŒdropã•ã‚Œã‚‹ã¨NoneãŒè¿”ã‚‹ï¼‰
    while let Some(value) = rx.recv().await {
        println!("å—ä¿¡: {}", value);
    }
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãŠãŠã€è¤‡æ•°ã®é€ä¿¡è€…ã‹ã‚‰1ã¤ã®å—ä¿¡è€…ï¼

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã“ã‚Œã‚’**mpscï¼ˆmultiple producer, single consumerï¼‰**ã£ã¦å‘¼ã¶ã®ã€‚ä»–ã«ã‚‚ãƒãƒ£ãƒãƒ«ã®ç¨®é¡ãŒã‚ã‚‹ã‚ˆã€‚

| ç¨®é¡ | ç”¨é€” | ç‰¹å¾´ |
|-----|------|------|
| `mpsc` | å¤šå¯¾ä¸€ | è¤‡æ•°ã®Producerã‹ã‚‰1ã¤ã®Consumerã¸ |
| `oneshot` | ä¸€å¯¾ä¸€ã€ä¸€å›é™ã‚Š | çµæœã‚’1å›ã ã‘è¿”ã™ |
| `broadcast` | ä¸€å¯¾å¤š | å…¨è³¼èª­è€…ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ |
| `watch` | ä¸€å¯¾å¤šã€æœ€æ–°å€¤ã®ã¿ | è¨­å®šå¤‰æ›´ã®é€šçŸ¥ãªã© |

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `oneshot`ã£ã¦ä½•ã«ä½¿ã†ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã‹ã‚‰1å›ã ã‘çµæœã‚’è¿”ã™ã¨ãã¨ã‹ã­ã€‚

```rust
use tokio::sync::oneshot;

#[tokio::main]
async fn main() {
    let (tx, rx) = oneshot::channel();

    tokio::spawn(async move {
        // é‡ã„è¨ˆç®—
        let result = 42;
        tx.send(result).unwrap();
    });

    let result = rx.await.unwrap();
    println!("çµæœ: {}", result);
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãªã‚‹ã»ã©ã€ã‚·ãƒ³ãƒ—ãƒ«ï¼

---

## 12. spawn_blockingã®é‡è¦æ€§

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: é‡ã„è¨ˆç®—å‡¦ç†ã‚’éåŒæœŸã‚¿ã‚¹ã‚¯ã®ä¸­ã§ã‚„ã£ã¡ã‚ƒã„ã‘ãªã„ã£ã¦èã„ãŸã‚“ã ã‘ã©...

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã„ã„æƒ…å ±ã‚’æ´ã‚“ã ã­ï¼CPUãƒã‚¦ãƒ³ãƒ‰ãªå‡¦ç†ã¯**éåŒæœŸã‚¿ã‚¹ã‚¯ã‚’ãƒ–ãƒ­ãƒƒã‚¯**ã—ã¡ã‚ƒã†ã®ã€‚

```rust
// âŒ æ‚ªã„ä¾‹
#[tokio::main]
async fn main() {
    // é‡ã„è¨ˆç®—ï¼ˆ10ç§’ã‹ã‹ã‚‹ï¼‰
    let mut sum = 0;
    for i in 0..10_000_000_000 {
        sum += i;
    }

    // ã“ã®é–“ã€ä»–ã®éåŒæœŸã‚¿ã‚¹ã‚¯ãŒæ­¢ã¾ã£ã¦ã—ã¾ã†ï¼
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãˆã€ãªã‚“ã§ï¼ŸéåŒæœŸãªã‚“ã ã‹ã‚‰å¤§ä¸ˆå¤«ã˜ã‚ƒãªã„ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: éåŒæœŸã¯**I/Oå¾…ã¡ã®é–“ã«ä»–ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹**ä»•çµ„ã¿ã§ã—ã‚‡ï¼Ÿã§ã‚‚CPUè¨ˆç®—ä¸­ã¯I/Oå¾…ã¡ã˜ã‚ƒãªã„ã‹ã‚‰ã€åˆ¶å¾¡ã‚’è¿”ã•ãªã„ã®ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã‚ã€ãªã‚‹ã»ã©...

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã ã‹ã‚‰`spawn_blocking`ã‚’ä½¿ã†ã®ã€‚ã“ã‚Œã¯åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚‰ã€éåŒæœŸãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ã€‚

```rust
use tokio::task::spawn_blocking;

fn heavy_computation() -> i32 {
    // CPUãƒã‚¦ãƒ³ãƒ‰ãªåŒæœŸå‡¦ç†
    let mut sum = 0;
    for i in 0..1_000_000 {
        sum += i;
    }
    sum
}

#[tokio::main]
async fn main() {
    // åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œï¼ˆéåŒæœŸãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ï¼‰
    let result = spawn_blocking(|| heavy_computation()).await.unwrap();
    println!("çµæœ: {}", result);
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã„ã¤`spawn_blocking`ãŒå¿…è¦ãªã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã“ã†ã„ã†ã¨ãã€‚

```
ã„ã¤spawn_blockingãŒå¿…è¦ã‹:
- é‡ã„è¨ˆç®—å‡¦ç†
- åŒæœŸçš„ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†å ´åˆ
- std::thread::sleepã‚’ä½¿ã†å ´åˆï¼ˆéåŒæœŸã§ã¯tokio::time::sleepã‚’ä½¿ã†ï¼‰
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `std::thread::sleep`ã‚’ä½¿ã£ã¡ã‚ƒãƒ€ãƒ¡ãªã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: asyncã®ä¸­ã§ä½¿ã†ã¨ã€ãã®é–“**ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å…¨ä½“ãŒæ­¢ã¾ã£ã¡ã‚ƒã†**ã®ã€‚

```rust
// âŒ æ‚ªã„ä¾‹
async fn bad_sleep() {
    std::thread::sleep(Duration::from_secs(1));  // ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒæ­¢ã¾ã‚‹ï¼
}

// âœ… è‰¯ã„ä¾‹
async fn good_sleep() {
    tokio::time::sleep(Duration::from_secs(1)).await;  // ä»–ã®ã‚¿ã‚¹ã‚¯ã¯å‹•ãç¶šã‘ã‚‹
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: æ°—ã‚’ã¤ã‘ãªã„ã¨ãª...

---

## 13. å®Ÿè·µ: ä¸¦åˆ—APIå‘¼ã³å‡ºã—

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: è¤‡æ•°ã®APIã‚’ä¸¦åˆ—ã«å‘¼ã³å‡ºã™å®Ÿè·µçš„ãªã‚³ãƒ¼ãƒ‰è¦‹ã›ã¦ï¼

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã„ã„ã­ã€ã‚ˆãã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã ã‚ˆã€‚

```rust
use reqwest::Client;
use serde::Deserialize;
use anyhow::Result;

#[derive(Debug, Deserialize)]
struct User {
    id: i32,
    name: String,
}

async fn fetch_user(client: &Client, id: i32) -> Result<User> {
    let url = format!("https://api.example.com/users/{}", id);
    let user = client.get(&url).send().await?.json().await?;
    Ok(user)
}

#[tokio::main]
async fn main() -> Result<()> {
    let client = Client::new();

    // è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä¸¦è¡Œå–å¾—
    let ids = vec![1, 2, 3, 4, 5];

    // å„IDã«å¯¾ã—ã¦Futureã‚’ä½œæˆ
    let futures: Vec<_> = ids.iter()
        .map(|&id| fetch_user(&client, id))
        .collect();

    // ã™ã¹ã¦ã®Futureã‚’ä¸¦è¡Œå®Ÿè¡Œ
    let results = futures::future::join_all(futures).await;

    for result in results {
        match result {
            Ok(user) => println!("{:?}", user),
            Err(e) => eprintln!("Error: {}", e),
        }
    }

    Ok(())
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `futures::future::join_all`ï¼Ÿã“ã‚Œtokioã˜ã‚ƒãªã„ã®ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã“ã‚Œã¯`futures`ã‚¯ãƒ¬ãƒ¼ãƒˆã®é–¢æ•°ã€‚å¯å¤‰é•·ã®Futureã‚’æ‰±ã†ã¨ãã«ä¾¿åˆ©ãªã®ã€‚`tokio::join!`ã¯ãƒã‚¯ãƒ­ã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å€‹æ•°ãŒæ±ºã¾ã£ã¦ãªã„ã¨ã„ã‘ãªã„ã‹ã‚‰ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãªã‚‹ã»ã©ã€‚JavaScriptã ã¨...

```javascript
const ids = [1, 2, 3, 4, 5];
const promises = ids.map(id => fetchUser(client, id));
const results = await Promise.all(promises);
```

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ãã†ã€åŒã˜ç™ºæƒ³ã ã­ã€‚

---

## 14. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: asyncã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã£ã¦ã©ã†ã™ã‚Œã°ã„ã„ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: åŸºæœ¬ã¯æ™®é€šã®Rustã¨åŒã˜ã§`Result`ã¨`?`ã‚’ä½¿ã†ã‚ˆã€‚

```rust
use tokio::fs;
use anyhow::{Context, Result};

async fn read_config() -> Result<String> {
    let content = fs::read_to_string("config.toml")
        .await
        .context("è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“")?;
    Ok(content)
}

#[tokio::main]
async fn main() -> Result<()> {
    match read_config().await {
        Ok(config) => println!("Config: {}", config),
        Err(e) => eprintln!("Error: {:?}", e),
    }
    Ok(())
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `anyhow`ã£ã¦ä½•ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æ¥½ã«ã™ã‚‹ã‚¯ãƒ¬ãƒ¼ãƒˆã€‚`context`ã§ã‚¨ãƒ©ãƒ¼ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ ã§ãã‚‹ã®ã€‚ã™ã”ãä¾¿åˆ©ã‚ˆã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `main`ã‚‚`Result`ã‚’è¿”ã›ã‚‹ã‚“ã ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã†ã‚“ã€`#[tokio::main]`ãŒå¯¾å¿œã—ã¦ã‚‹ã®ã€‚ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒçµ‚äº†ã—ã¦ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã¦ãã‚Œã‚‹ã€‚

---

## 15. Pinã®è¬ï¼ˆä¸Šç´šè€…å‘ã‘ï¼‰

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã•ã£ã`Pin<&mut Self>`ã£ã¦ã„ã†ã®ãŒã‚ã£ãŸã‘ã©ã€ã‚ã‚Œã£ã¦ä½•ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã“ã‚Œã¯ä¸Šç´šãƒˆãƒ”ãƒƒã‚¯ã ã‘ã©ã€èˆˆå‘³ã‚ã‚‹ãªã‚‰èª¬æ˜ã™ã‚‹ã‚ˆã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: æ•™ãˆã¦ï¼

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: `async`ãƒ–ãƒ­ãƒƒã‚¯ã¯å†…éƒ¨ã§**è‡ªå·±å‚ç…§æ§‹é€ ä½“**ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã€‚

```rust
async fn example() {
    let data = vec![1, 2, 3];
    let reference = &data;  // dataã¸ã®å‚ç…§

    some_async_operation().await;  // â† ã“ã®é–“ã«æ§‹é€ ä½“ãŒãƒ¡ãƒ¢ãƒªä¸Šã§ç§»å‹•ã™ã‚‹ã¨...

    println!("{:?}", reference);  // referenceãŒç„¡åŠ¹ã«ãªã‚‹å¯èƒ½æ€§ï¼
}
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: `.await`ã‚’ã¾ãŸã„ã§å‚ç…§ã‚’æŒã£ã¦ã‚‹ã®ãŒå•é¡Œï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€‚Futureã¯å†…éƒ¨ã§ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã«ãªã£ã¦ã¦ã€`.await`ã”ã¨ã«çŠ¶æ…‹ãŒå¤‰ã‚ã‚‹ã®ã€‚ãã®éš›ã«ãƒ¡ãƒ¢ãƒªä¸Šã§ç§»å‹•ï¼ˆãƒ ãƒ¼ãƒ–ï¼‰ã™ã‚‹ã¨ã€è‡ªå·±å‚ç…§ãŒå£Šã‚Œã¡ã‚ƒã†ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãã‚Œã§`Pin`ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã†ã‚“ã€‚`Pin`ã¯ã€Œã“ã®å€¤ã¯ãƒ¡ãƒ¢ãƒªä¸Šã§ç§»å‹•ã—ãªã„ã€ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹å‹ãªã®ã€‚

```rust
use std::pin::Pin;

// poll ã®å®šç¾©
fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output>;
//           ^^^^^^^^^^^^
//           Pin<&mut Self> = ã€Œã“ã®Futureã¯ç§»å‹•ã—ãªã„ã€ã¨ã„ã†ä¿è¨¼
```

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: æ™®é€šã«async/awaitã‚’ä½¿ã†ã ã‘ãªã‚‰æ„è­˜ã—ãªãã¦ã„ã„ï¼Ÿ

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ï¼ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒå…¨éƒ¨ã‚„ã£ã¦ãã‚Œã‚‹ã‹ã‚‰ã€‚`Pin`ã‚’æ„è­˜ã™ã‚‹ã®ã¯ã€æ‰‹å‹•ã§Futureã‚’å®Ÿè£…ã™ã‚‹ã¨ãã¨ã‹ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œã‚‹ã¨ãã ã‘ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ãµãƒ¼ã€é›£ã—ã„ä¸–ç•Œã ...

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã§ã‚‚çŸ¥ã£ã¦ãŠãã¨ã€éåŒæœŸã®è£å´ãŒã‚ã‹ã£ã¦é¢ç™½ã„ã§ã—ã‚‡ï¼Ÿ

---

## 16. JavaScript/TypeScriptã‹ã‚‰ã®ç§»è¡Œã‚¬ã‚¤ãƒ‰

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã“ã“ã¾ã§å­¦ã‚“ã§ã€JavaScriptã¨ã®é•ã„ã‚’ã¾ã¨ã‚ãŸã„ãªã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã„ã„ã­ï¼è¡¨ã«ã¾ã¨ã‚ã¦ã¿ã‚ˆã†ã€‚

| æ¦‚å¿µ | JavaScript | Python | Rust |
|-----|------------|--------|------|
| éåŒæœŸé–¢æ•° | `async function` | `async def` | `async fn` |
| å¾…æ©Ÿ | `await` | `await` | `.await`ï¼ˆå¾Œç½®ï¼‰ |
| Promise/Future | Promise | Coroutine | Future |
| ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  | çµ„ã¿è¾¼ã¿ | asyncio | tokioï¼ˆå¤–éƒ¨ï¼‰ |
| ä¸¦è¡Œå®Ÿè¡Œ | `Promise.all` | `asyncio.gather` | `tokio::join!` |
| ãƒ¬ãƒ¼ã‚¹ | `Promise.race` | `asyncio.wait` | `tokio::select!` |
| é…å»¶è©•ä¾¡ | âŒï¼ˆå³æ™‚å®Ÿè¡Œï¼‰ | â–³ | âœ…ï¼ˆæ˜ç¤ºçš„ï¼‰ |

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: æœ€å¤§ã®é•ã„ã¯ã€Œé…å»¶è©•ä¾¡ã€ã ã­ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ã€‚Rustã¯`await`ã™ã‚‹ã¾ã§ä½•ã‚‚èµ·ããªã„ã‹ã‚‰ã€**æ˜ç¤ºçš„ã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹**ã®ãŒå¼·ã¿ã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã‚ã¨ã€GILãŒãªã„ã®ã‚‚é‡è¦ã ã‚ˆã­ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ãã†ãªã®ï¼Pythonã¯GILï¼ˆGlobal Interpreter Lockï¼‰ãŒã‚ã‚‹ã‹ã‚‰ã€ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚‚CPUä¸¦åˆ—ã¯åŠ¹ã‹ãªã„ã€‚ã§ã‚‚Rustã¯çœŸã®ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ãŒã§ãã‚‹ã€‚

```
GILãŒãªã„ = çœŸã®ä¸¦åˆ—

Python: GILã®ãŸã‚ã€CPUãƒã‚¦ãƒ³ãƒ‰ãªå‡¦ç†ã¯1ã‚³ã‚¢ã—ã‹ä½¿ãˆãªã„
        asyncioã¯I/Oãƒã‚¦ãƒ³ãƒ‰ãªå‡¦ç†ã«ã¯æœ‰åŠ¹ã ãŒã€CPUä¸¦åˆ—ã¯multiprocessingãŒå¿…è¦

Rust:   GILãªã—ã€‚tokio::spawnã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã¯ç•°ãªã‚‹CPUã‚³ã‚¢ã§å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§
```

---

## 17. ã‚ˆãã‚ã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: æœ€å¾Œã«ã€ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•ã‚’æ•™ãˆã¦ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã„ã„ã­ã€‚3ã¤ã®é »å‡ºã‚¨ãƒ©ãƒ¼ã‚’è¦šãˆã¦ãŠã“ã†ã€‚

**ã‚¨ãƒ©ãƒ¼1: `future cannot be sent between threads safely`**

```
error: future cannot be sent between threads safely
...the trait `Send` is not implemented for `Rc<...>`
```

**åŸå› **: `Rc`ãªã©`Send`ã‚’å®Ÿè£…ã—ã¦ã„ãªã„å‹ã‚’ä½¿ã£ã¦ã„ã‚‹
**å¯¾å‡¦**: `Arc`ã«ç½®ãæ›ãˆã‚‹

```rust
// âŒ use std::rc::Rc;
// âœ… use std::sync::Arc;
```

**ã‚¨ãƒ©ãƒ¼2: `borrowed value does not live long enough`**

```
error[E0597]: `data` does not live long enough
```

**åŸå› **: spawnã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ãŒå‚ç…§ã‚’æŒã£ã¦ã„ã‚‹ãŒã€å…ƒã®å¤‰æ•°ãŒå…ˆã«ç ´æ£„ã•ã‚Œã‚‹
**å¯¾å‡¦**: `clone()`ã¾ãŸã¯`Arc`ã§æ‰€æœ‰æ¨©ã‚’æ¸¡ã™ã€ã¾ãŸã¯`move`ã‚’ä½¿ã†

**ã‚¨ãƒ©ãƒ¼3: `async block may outlive the current function`**

**åŸå› **: async blockãŒé–¢æ•°ã‚ˆã‚Šé•·ãç”Ÿå­˜ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŒã€ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã‚’å€Ÿç”¨ã—ã¦ã„ã‚‹
**å¯¾å‡¦**: `async move`ã‚’ä½¿ã£ã¦æ‰€æœ‰æ¨©ã‚’ç§»å‹•

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: ã“ã‚Œè¦šãˆã¦ãŠã‘ã°å¤§ä¸ˆå¤«ãã†ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã‚ã¨ã¯å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨æ ¼é—˜ã™ã‚‹ã“ã¨ã­ã€‚Rustã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¦ªåˆ‡ã ã‹ã‚‰ã€ã‚ˆãèª­ã‚ã°è§£æ±ºã§ãã‚‹ã‚ˆã€‚

---

## ã¾ã¨ã‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: Rustã®éåŒæœŸã€æœ€åˆã¯é›£ã—ãã†ã ã£ãŸã‘ã©ç†è§£ã§ãã¦ããŸï¼

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã™ã”ã„ï¼æœ€å¾Œã«ãƒã‚¤ãƒ³ãƒˆã‚’ãŠã•ã‚‰ã„ã—ã‚ˆã†ã€‚

ğŸ¯ **ã“ã®ç« ã®ãƒã‚¤ãƒ³ãƒˆ**:

1. **Futureã¯é…å»¶è©•ä¾¡** â€” `await`ã™ã‚‹ã¾ã§å®Ÿè¡Œã•ã‚Œãªã„
2. **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒå¿…è¦** â€” tokioãŒæœ€ã‚‚ãƒãƒ”ãƒ¥ãƒ©ãƒ¼
3. **join!** = ä¸¦è¡Œå®Ÿè¡Œã€**select!** = ãƒ¬ãƒ¼ã‚¹
4. **spawn** = ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ï¼ˆ`Send + 'static`ãŒå¿…è¦ï¼‰
5. **async move** = ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã«æ‰€æœ‰æ¨©ã‚’ç§»å‹•
6. **ãƒãƒ£ãƒãƒ«** = ã‚¿ã‚¹ã‚¯é–“é€šä¿¡
7. **spawn_blocking** = CPUé‡ã„å‡¦ç†ã¯åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã¸

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: JavaScriptã¨ä¼¼ã¦ã‚‹ã‚ˆã†ã§ã€å…¨ç„¶é•ã†ã‚“ã ã­ã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã§ã‚‚ãã®é•ã„ã“ããŒã€Rustã®**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**ã¨**å®‰å…¨æ€§**ã‚’å®Ÿç¾ã—ã¦ã‚‹ã®ã€‚éåŒæœŸå‡¦ç†ã§ã‚‚ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ã‚’ä¿è¨¼ã§ãã‚‹ã®ãŒRustã®å¼·ã¿ã‚ˆã€‚

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: æ¬¡ã¯å®Ÿéš›ã«Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚ŠãŸã„ãªã€‚

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã„ã„ã­ï¼[Chapter 09: Webé–‹ç™º](09-web-development.md) ã§ã¯ã€Axumãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ãŸREST APIé–‹ç™ºã‚’å­¦ã¶ã‚ˆã€‚ã“ã®ç« ã§å­¦ã‚“ã éåŒæœŸã®çŸ¥è­˜ãŒå…¨éƒ¨æ´»ãã¦ãã‚‹ã‹ã‚‰æ¥½ã—ã¿ã«ã—ã¦ã¦ï¼

> ğŸ‘©â€ğŸ’» **ãƒ¦ã‚¤**: æ¥½ã—ã¿ï¼ãƒ¦ã‚¤ã€ã‚ã‚ŠãŒã¨ã†ï¼

> ğŸ‘©â€ğŸ« **ãƒ¬ã‚¤**: ã©ã†ã„ãŸã—ã¾ã—ã¦ã€‚ä¸€ç·’ã«é ‘å¼µã‚ã†ã­ï¼

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

[Chapter 09: Webé–‹ç™º](09-web-development.md) ã§ã¯ã€Axumãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ãŸREST APIé–‹ç™ºã‚’å­¦ã³ã¾ã™ã€‚ã“ã®ç« ã§å­¦ã‚“ã éåŒæœŸã®çŸ¥è­˜ãŒå®Ÿè·µçš„ã«æ´»ç”¨ã•ã‚Œã¾ã™ã€‚

---

**ğŸ“ å­¦ç¿’ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

- [ ] async/awaitã®åŸºæœ¬æ–‡æ³•ã‚’ç†è§£ã—ãŸ
- [ ] Futureã®é…å»¶è©•ä¾¡ã‚’ç†è§£ã—ãŸ
- [ ] tokioãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®å½¹å‰²ã‚’ç†è§£ã—ãŸ
- [ ] join!ã¨select!ã®ä½¿ã„åˆ†ã‘ãŒã§ãã‚‹
- [ ] spawnã®åˆ¶ç´„ï¼ˆSend + 'staticï¼‰ã‚’ç†è§£ã—ãŸ
- [ ] async moveã‚’ã„ã¤ä½¿ã†ã‹ç†è§£ã—ãŸ
- [ ] ãƒãƒ£ãƒãƒ«ã§ã‚¿ã‚¹ã‚¯é–“é€šä¿¡ãŒã§ãã‚‹
- [ ] spawn_blockingã®é‡è¦æ€§ã‚’ç†è§£ã—ãŸ
- [ ] ã‚ˆãã‚ã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«å¯¾å‡¦ã§ãã‚‹

---

**ğŸ“š ã•ã‚‰ã«å­¦ã³ãŸã„äººã¸**

- [Tokioå…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://tokio.rs/tokio/tutorial)
- [Async Book](https://rust-lang.github.io/async-book/)
- [Jon Gjengset - Crust of Rust: async/await](https://www.youtube.com/watch?v=ThjvMReOXYM)

---

ğŸ’¬ **ãƒ¬ã‚¤ã‚ˆã‚Š**: éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€æœ€åˆã¯é›£ã—ã„ã¨æ€ã£ã¦ãŸã‘ã©ã€ãƒ¦ã‚¤ã®ãŠã‹ã’ã§ç†è§£ã§ããŸï¼Futureã®é…å»¶è©•ä¾¡ã¨ã‹ã€JavaScriptã¨ã¯å…¨ç„¶é•ã†ä¸–ç•Œã§æ–°é®®ã ã£ãŸãªã€‚æ¬¡ã®Webé–‹ç™ºã®ç« ãŒæ¥½ã—ã¿ï¼
